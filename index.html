<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>TMスタッツ Pro 出場時間カウンタ版</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
    background:#f3f4f6;
    margin:0;
    padding:8px;
}

.card{
    background:#fff;
    padding:12px;
    border-radius:12px;
    margin-bottom:10px;
}

.player-list{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:4px;
    max-height:220px;
    overflow:auto;
    font-size:14px;
}

button{
    width:100%;
    padding:8px;
    border:none;
    border-radius:8px;
    margin-top:6px;
}

.primary{background:#2563eb;color:#fff;}
.success{background:#16a34a;color:#fff;}

.timer{
    color:#2563eb;
    font-weight:bold;
    margin-left:8px;
}
</style>
</head>

<body>

<h2>TMスタッツ Pro（出場時間カウント版）</h2>

<div class="card">

<div>選手選択（出場時間カウント対象）</div>

<div class="player-list" id="playerList"></div>

<button class="primary" onclick="startInput()">入力開始</button>
<button class="success" onclick="finishMatch()">試合終了</button>

</div>

<script>

/* ===============================
選手定義
=============================== */

const players=[
"2 りょう","3 はるみち","4 いっさ","5 はるや","6 だいち","7 ひなた",
"8 りく","9 あつと","10 だいき","11 とうり","13 しゅうせい",
"14 けいすけ","17 ゆうだい","18 しょう","19 しゅん","20 こう",
"22 にへこう","23 たもん","24 はたこう","25 けいま","26 とうま",
"27 そうしろう","28 しょうま","29 たいしん","30 ゆう",
"35 あやと","36 はる","37 かい","38 あらた","39 はると"
];

let timerInterval=null;

/* 選手状態管理 */
let playerState={};

/* ===============================
UI生成
=============================== */

const playerList=document.getElementById("playerList");

players.forEach(p=>{

    const label=document.createElement("label");

    const check=document.createElement("input");
    check.type="checkbox";
    check.value=p;

    check.onchange=()=>syncPlayerTimer();

    label.appendChild(check);
    label.append(" "+p);

    const span=document.createElement("span");
    span.id="timer_"+p.replace(" ","_");
    span.className="timer";
    span.innerText="00:00";

    label.appendChild(span);

    playerList.appendChild(label);

    playerState[p]={
        active:false,
        time:0
    };
});

/* ===============================
入力開始（カウント開始）
=============================== */

function startInput(){

    syncPlayerTimer();

    if(timerInterval) return;

    timerInterval=setInterval(()=>{

        Object.keys(playerState).forEach(name=>{
            if(playerState[name].active){
                playerState[name].time++;
                updateTimerUI(name);
            }
        });

    },1000);
}

/* ===============================
チェック状態同期
=============================== */

function syncPlayerTimer(){

    document.querySelectorAll("#playerList input").forEach(el=>{

        const name=el.value;

        if(el.checked){
            playerState[name].active=true;
        }else{
            playerState[name].active=false;
        }

    });
}

/* ===============================
UI更新（分秒表示）
=============================== */

function updateTimerUI(name){

    const sec=playerState[name].time;

    const m=Math.floor(sec/60);
    const s=sec%60;

    const target=document.getElementById(
        "timer_"+name.replace(" ","_")
    );

    if(target){
        target.innerText=
            String(m).padStart(2,"0")+
            ":"+
            String(s).padStart(2,"0");
    }
}

/* ===============================
試合終了
=============================== */

function finishMatch(){

    if(timerInterval){
        clearInterval(timerInterval);
        timerInterval=null;
    }

    Object.keys(playerState).forEach(name=>{
        playerState[name].active=false;
    });
}

</script>

</body>
</html>
