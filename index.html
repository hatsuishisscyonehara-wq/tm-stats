<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>TMã‚¹ã‚¿ãƒƒãƒ„ Pro å®Œå…¨ç‰ˆï¼ˆç”»åƒå‡ºåŠ›å‰Šé™¤ï¼‰</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>

body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
    background:#f3f4f6;
    margin:0;
    padding:8px;
}

.card{
    background:#fff;
    padding:14px;
    border-radius:12px;
    margin-bottom:12px;
    box-shadow:0 3px 8px rgba(0,0,0,0.08);
}

.form-row{
    display:flex;
    flex-direction:column;
    margin-bottom:10px;
}

.form-row label{
    font-size:13px;
    font-weight:bold;
    margin-bottom:4px;
    color:#374151;
}

input,select{
    padding:8px;
    border-radius:8px;
    border:1px solid #cbd5e1;
    font-size:15px;
}

.player-list{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:4px;
    max-height:200px;
    overflow:auto;
    font-size:14px;
}

.counter{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:4px;
}

.counter button{
    width:32px;
    height:32px;
    border:none;
    border-radius:6px;
    background:#e2e8f0;
}

.value{
    width:30px;
    text-align:center;
}

.timer{
    color:#2563eb;
    font-weight:bold;
    margin-left:6px;
}

button{
    width:100%;
    padding:8px;
    border:none;
    border-radius:8px;
    margin-top:6px;
    font-size:15px;
}

.primary{background:#2563eb;color:#fff;}
.success{background:#16a34a;color:#fff;}

/* ===== README Modal ===== */

#readmeModal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.6);
}

#readmeContent{
    background:#fff;
    margin:40px auto;
    padding:20px;
    width:90%;
    max-height:80%;
    overflow:auto;
    border-radius:12px;
}

</style>
</head>

<body>

<!-- READMEãƒªãƒ³ã‚¯ï¼ˆæœ€ä¸Šéƒ¨ï¼‰ -->
<button class="primary" onclick="showReadme()" style="margin-bottom:8px;">
ğŸ“˜ ReadMeï¼ˆä½¿ã„æ–¹èª¬æ˜ï¼‰
</button>

<h2>TMã‚¹ã‚¿ãƒƒãƒ„ Pro</h2>

<div class="card">

<div class="form-row">
<label>æ—¥ã«ã¡</label>
<input type="date" id="matchDate">
</div>

<div class="form-row">
<label>å¯¾æˆ¦ç›¸æ‰‹ï¼ˆãƒ•ãƒªãƒ¼å…¥åŠ›ï¼‰</label>
<input type="text" id="opponent" placeholder="ä¾‹ï¼šåˆçŸ³SSC1è©¦åˆç›®">
</div>

<div class="form-row">
<label>ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</label>
<select id="formation">
<option value="">é¸æŠã—ã¦ãã ã•ã„</option>
<option value="4-2-1">4-2-1</option>
<option value="3-3-1">3-3-1</option>
<option value="2-3-2">2-3-2</option>
</select>
</div>

</div>

<div class="card">

<div>å…¥åŠ›ã‚¿ã‚¤ãƒ—</div>

<label><input type="radio" name="mode" value="attack"> æ”»æ’ƒ</label>
<label><input type="radio" name="mode" value="defense"> å®ˆå‚™</label>
<label><input type="radio" name="mode" value="both"> æ”»æ’ƒå®ˆå‚™ä¸¡æ–¹</label>

</div>

<div class="card">

<div>å‡ºå ´é¸æ‰‹ï¼ˆå‡ºå ´æ™‚é–“ã‚«ã‚¦ãƒ³ãƒˆï¼‰</div>

<div class="player-list" id="playerList"></div>

<button class="primary" onclick="startMatch()">è©¦åˆé–‹å§‹</button>
<button class="success" onclick="finishMatch()">è©¦åˆçµ‚äº†</button>
<button class="primary" onclick="clearAllData()">å…¨ã‚¯ãƒªã‚¢</button>

</div>

<div id="inputArea"></div>

<button class="success" onclick="finishMatch()">è©¦åˆçµ‚äº†</button>
<button class="success" onclick="exportExcel()">Excelå‡ºåŠ›</button>
<button class="primary" onclick="clearAllData()">å…¨ã‚¯ãƒªã‚¢</button>

<!-- README Modal -->
<div id="readmeModal" onclick="closeReadme()">
<div id="readmeContent" onclick="event.stopPropagation()"></div>
</div>

<script>

/* ===== README TEXT ===== */

const README_TEXT = `
TMã‚¹ã‚¿ãƒƒãƒ„ Proï¼ˆå°‘å¹´ã‚µãƒƒã‚«ãƒ¼è©¦åˆã‚¹ã‚¿ãƒƒãƒ„å…¥åŠ›ã‚¢ãƒ—ãƒªï¼‰

â–  åŸºæœ¬æ“ä½œæ‰‹é †

â‘  è©¦åˆæƒ…å ±ã‚’å…¥åŠ›
ãƒ»æ—¥ã«ã¡
ãƒ»å¯¾æˆ¦ç›¸æ‰‹ï¼ˆä¾‹ï¼šåˆçŸ³SSC1è©¦åˆç›®ï¼‰
ãƒ»ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé¸æŠå¼ï¼‰

â‘¡ å…¥åŠ›ã‚¿ã‚¤ãƒ—é¸æŠ
ãƒ»æ”»æ’ƒ
ãƒ»å®ˆå‚™
ãƒ»æ”»æ’ƒå®ˆå‚™ä¸¡æ–¹

â‘¢ å‡ºå ´é¸æ‰‹é¸æŠ
ãƒã‚§ãƒƒã‚¯ã‚’ä»˜ã‘ãŸé¸æ‰‹ãŒå¯¾è±¡ã§ã™ã€‚
è©¦åˆé–‹å§‹å¾Œã‚‚é¸æ‰‹è¿½åŠ ãƒ»å‰Šé™¤ãŒå¯èƒ½ã§ã™ã€‚

â‘£ è©¦åˆé–‹å§‹
ãƒ»å‡ºå ´æ™‚é–“ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹
ãƒ»ã‚¹ã‚¿ãƒƒãƒ„å…¥åŠ›UIç”Ÿæˆ

â‘¤ ã‚¹ã‚¿ãƒƒãƒ„å…¥åŠ›
ï¼‹ãƒœã‚¿ãƒ³ï¼šã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ 
ï¼ãƒœã‚¿ãƒ³ï¼šã‚«ã‚¦ãƒ³ãƒˆæ¸›å°‘ï¼ˆ0ä»¥ä¸‹ã«ã¯ãªã‚Šã¾ã›ã‚“ï¼‰

â‘¥ è©¦åˆçµ‚äº†
ãƒ»ã‚«ã‚¦ãƒ³ãƒˆåœæ­¢

â‘¦ Excelå‡ºåŠ›
ãƒ»å‡ºå ´æ™‚é–“1ç§’ä»¥ä¸Šã®é¸æ‰‹ã®ã¿å‡ºåŠ›

â€»ãƒšãƒ¼ã‚¸æ›´æ–°ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆãˆã¾ã™ã€‚

--------------------------------
æœ¬ã‚¢ãƒ—ãƒªã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…å‹•ä½œå‹ã§ã™ã€‚
`;

function showReadme(){
    document.getElementById("readmeContent").innerText=README_TEXT;
    document.getElementById("readmeModal").style.display="block";
}

function closeReadme(){
    document.getElementById("readmeModal").style.display="none";
}

/* ===============================
ä»¥ä¸‹ã€å…ƒã‚¢ãƒ—ãƒªãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¤‰æ›´ãªã—ï¼‰
=============================== */

const players=[
"2 ã‚Šã‚‡ã†","3 ã¯ã‚‹ã¿ã¡","4 ã„ã£ã•","5 ã¯ã‚‹ã‚„","6 ã ã„ã¡","7 ã²ãªãŸ",
"8 ã‚Šã","9 ã‚ã¤ã¨","10 ã ã„ã","11 ã¨ã†ã‚Š","13 ã—ã‚…ã†ã›ã„",
"14 ã‘ã„ã™ã‘","17 ã‚†ã†ã ã„","18 ã—ã‚‡ã†","19 ã—ã‚…ã‚“","20 ã“ã†",
"22 ã«ã¸ã“ã†","23 ãŸã‚‚ã‚“","24 ã¯ãŸã“ã†","25 ã‘ã„ã¾","26 ã¨ã†ã¾",
"27 ãã†ã—ã‚ã†","28 ã—ã‚‡ã†ã¾","29 ãŸã„ã—ã‚“","30 ã‚†ã†",
"35 ã‚ã‚„ã¨","36 ã¯ã‚‹","37 ã‹ã„","38 ã‚ã‚‰ãŸ","39 ã¯ã‚‹ã¨"
];

const attackKeys=["CHA","SHO","HD_O","THP","LP"];
const defenseKeys=["SZ","PO","HD_D","SL"];

const labels={
CHA:"ã€æ”»æ’ƒã€‘ãƒ‰ãƒªãƒ–ãƒ«ãƒãƒ£ãƒ¬ãƒ³ã‚¸",
SHO:"ã€æ”»æ’ƒã€‘ã‚·ãƒ¥ãƒ¼ãƒˆ",
HD_O:"ã€æ”»æ’ƒã€‘ãƒ˜ãƒ‡ã‚£ãƒ³ã‚°",
THP:"ã€æ”»æ’ƒã€‘ã‚¹ãƒ«ãƒ¼ãƒ‘ã‚¹",
LP:"ã€æ”»æ’ƒã€‘ãƒ­ãƒ³ã‚°ãƒ‘ã‚¹",
SZ:"ã€å®ˆå‚™ã€‘ãƒœãƒ¼ãƒ«å®Œå…¨å¥ªå–",
PO:"ã€å®ˆå‚™ã€‘æŠœã‹ã‚ŒãŸæ•°",
HD_D:"ã€å®ˆå‚™ã€‘ãƒ˜ãƒ‡ã‚£ãƒ³ã‚°ã‚¯ãƒªã‚¢",
SL:"ã€å®ˆå‚™ã€‘ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°"
};

let records={};
let playerState={};
let currentMode="";
let timerInterval=null;
let matchStarted=false;

/* UIç”Ÿæˆ */

const playerList=document.getElementById("playerList");

players.forEach(p=>{

    const label=document.createElement("label");

    const check=document.createElement("input");
    check.type="checkbox";
    check.value=p;
    check.onchange=syncPlayerTimer;

    label.appendChild(check);
    label.append(" "+p);

    const span=document.createElement("span");
    span.id="timer_"+p.replace(" ","_");
    span.className="timer";
    span.innerText="00:00";

    label.appendChild(span);

    playerList.appendChild(label);

    playerState[p]={active:false,time:0};

    records[p]={};
    [...attackKeys,...defenseKeys].forEach(k=>records[p][k]=0);
});

/* è©¦åˆé–‹å§‹ */

function startMatch(){

    const mode=document.querySelector("input[name='mode']:checked");

    if(!mode){
        alert("å…¥åŠ›ã‚¿ã‚¤ãƒ—é¸æŠ");
        return;
    }

    currentMode=mode.value;
    matchStarted=true;

    syncPlayerTimer();

    if(!timerInterval){
        timerInterval=setInterval(()=>{

            Object.keys(playerState).forEach(name=>{
                if(playerState[name].active){
                    playerState[name].time++;
                    updateTimerUI(name);
                }
            });

        },1000);
    }

    renderCounters();
}

/* ãƒã‚§ãƒƒã‚¯åŒæœŸï¼ˆå‹•çš„UIæ›´æ–°ï¼‰ */

function syncPlayerTimer(){

    document.querySelectorAll("#playerList input").forEach(el=>{
        playerState[el.value].active=el.checked;
    });

    if(matchStarted){
        renderCounters();
    }
}

/* å…¨ã‚¯ãƒªã‚¢ */

function clearAllData(){

    if(!confirm("å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")) return;

    Object.keys(records).forEach(p=>{
        [...attackKeys,...defenseKeys].forEach(k=>{
            records[p][k]=0;
        });
    });

    Object.values(playerState).forEach(st=>{
        st.time=0;
        st.active=false;
    });

    document.querySelectorAll(".value").forEach(el=>{
        el.innerText="0";
    });

    document.querySelectorAll(".timer").forEach(el=>{
        el.innerText="00:00";
    });

    document.querySelectorAll("#playerList input")
    .forEach(el=>el.checked=false);

    inputArea.innerHTML="";
    matchStarted=false;
}

/* ã‚«ã‚¦ãƒ³ã‚¿UI */

function renderCounters(){

    inputArea.innerHTML="";

    const checked=[...document.querySelectorAll("#playerList input:checked")];

    const showAttack=currentMode==="attack"||currentMode==="both";
    const showDefense=currentMode==="defense"||currentMode==="both";

    checked.forEach(c=>{

        const name=c.value;

        const card=document.createElement("div");
        card.className="card";

        card.innerHTML=`<b>${name}</b>`;

        if(showAttack){
            attackKeys.forEach(k=>{
                card.innerHTML+=counterHTML(name,k);
            });
        }

        if(showDefense){
            defenseKeys.forEach(k=>{
                card.innerHTML+=counterHTML(name,k);
            });
        }

        inputArea.appendChild(card);
    });
}

function counterHTML(name,key){
    return `
    <div class="counter">
        <div style="flex:1">${labels[key]}</div>
        <button onclick="change('${name}','${key}',-1)">-</button>
        <div class="value" id="${name}_${key}">
        ${records[name][key]}
        </div>
        <button onclick="change('${name}','${key}',1)">+</button>
    </div>`;
}

function change(player,key,delta){

    records[player][key]+=delta;

    if(records[player][key]<0)
        records[player][key]=0;

    document.getElementById(`${player}_${key}`)
        .innerText=records[player][key];
}

function updateTimerUI(name){

    const sec=playerState[name].time;

    const m=Math.floor(sec/60);
    const s=sec%60;

    document.getElementById(
        "timer_"+name.replace(" ","_")
    ).innerText=
        String(m).padStart(2,"0")+":"+
        String(s).padStart(2,"0");
}

function finishMatch(){

    alert("å‡ºå ´æ™‚é–“ã‚«ã‚¦ãƒ³ãƒˆã‚’çµ‚äº†ã—ã¾ã™ã€‚");

    if(timerInterval){
        clearInterval(timerInterval);
        timerInterval=null;
    }

    matchStarted=false;

    Object.keys(playerState).forEach(name=>{
        playerState[name].active=false;
    });
}

function exportExcel(){

    const exportPlayers=Object.keys(playerState)
        .filter(name=>playerState[name].time>=1);

    if(!exportPlayers.length){
        alert("å‡ºå ´æ™‚é–“1ç§’ä»¥ä¸Šã®é¸æ‰‹ãŒã„ã¾ã›ã‚“");
        return;
    }

    const rows=[];

    exportPlayers.forEach(player=>{

        const r=records[player];
        const parts=player.split(" ");

        const sec=playerState[player].time;
        const m=Math.floor(sec/60);
        const s=sec%60;

        rows.push({
            å¯¾æˆ¦ç›¸æ‰‹:opponent.value||"",
            æ—¥ã«ã¡:matchDate.value||"",
            ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:formation.value||"",
            æ”»å®ˆ:currentMode,
            é¸æ‰‹NO:parts[0],
            é¸æ‰‹å:parts[1],
            å‡ºå ´æ™‚é–“:`${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`,
            CHA:r.CHA||0,
            SHO:r.SHO||0,
            HD_O:r.HD_O||0,
            THP:r.THP||0,
            LP:r.LP||0,
            SZ:r.SZ||0,
            PO:r.PO||0,
            HD_D:r.HD_D||0,
            SL:r.SL||0
        });
    });

    const wb=XLSX.utils.book_new();
    const ws=XLSX.utils.json_to_sheet(rows);

    XLSX.utils.book_append_sheet(wb,ws,"TM");

    const yyyymmdd=(matchDate.value||"").replaceAll("-","");
    const opponentName=(opponent.value||"match").replace(/\s+/g,"");

    XLSX.writeFile(
        wb,
        `${yyyymmdd}_${opponentName}.xlsx`
    );
}

</script>

</body>
</html>
